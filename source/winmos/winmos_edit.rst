.. include:: ../common.rst

.. _edit_top:

編集メニュー
============================================

メインウインドウに表示されている分子構造を編集する機能が収められています。
各機能は、メインウインドウで選択された原子に対して作用します。

.. include:: winmos_selection.rst

自動で生成される結合は、原子間距離が（共有結合半径の和）×（係数）より小さい場合に生成されます。係数はデフォルトで ``1.15`` となっていて、この値は環境設定ウインドウで変更できます。

:ref:`edit_atom_add` 、 :ref:`edit_atom_move` 、 :ref:`edit_partial_rotate` などマウス操作を伴う機能は、 :kbd:`Esc` キーまたは同機能のメニューのチェックを外すことでキャンセルできます。

元に戻す
-------------------------------------
   各種編集操作を元に戻します。50回まで可能です。
   
やり直し
-------------------------------------
   元に戻した操作をやり直します。50回まで可能です。
   
テキストを戻す
-------------------------------------
   :ref:`キーワード表示エリア <gui_main>` で編集した内容を元に戻します。
   
直接編集
-------------------------------------
   Winmostar内製のテキストエディタで座標データを表示・編集します。外部アプリケーションで開きたい場合は :menuselection:`ファイル -->` :ref:`file_editor` を選択してください。
   
.. _edit_atom:
   
原子
-------------------------------------

.. _edit_atom_add:

原子追加
^^^^^^^^^^^^^^^^^^^^
   :ref:`分子表示エリア <gui_main>` にてクリックする位置に原子を追加します。追加される原子の種類は :ref:`編集ボタンエリア <gui_main>` の :guilabel:`元素選択` プルダウンメニュー |chg| で選択します。Z-Matrix表記における接続原子を指定しながら追加したい場合は、 :menuselection:`編集 --> Z-Matrix -->` :ref:`edit_zm_addatom` を使います。
   
   .. hint::
      :kbd:`F4` または :ref:`編集ボタンエリア <gui_main>` の :guilabel:`原子追加` ボタンでも操作できます。
      
.. _edit_atom_move:

原子移動 
^^^^^^^^^^^^^^^^^^^^
   :ref:`マーカー <edit_top>` が付いた原子をドラッグして移動します。
   
   .. hint::
      :kbd:`F5` でも操作できます。
      
原子削除 
^^^^^^^^^^^^^^^^^^^^
   :ref:`マーカー <edit_top>` が付いた原子を削除します。
   
   .. hint::
      :kbd:`Shift+F4` または :ref:`編集ボタンエリア <gui_main>` の :guilabel:`原子削除` ボタン でも操作できます。
      
元素変更
^^^^^^^^^^^^^^^^^^^^
   選択した原子の元素を  :ref:`編集ボタンエリア <gui_main>` の :guilabel:`元素選択` プルダウンメニュー |chg| で選択した元素に変更します。グループ選択されている場合はグループ選択された原子が対象となります。
   
   .. hint::
      :kbd:`Shift+F5` または :ref:`編集ボタンエリア <gui_main>` の :guilabel:`Chg` ボタンでも操作できます。
      
   .. note::
       :guilabel:`Lp 0` はLone pair、 :guilabel:`Cb 104` はMOPACで分子構造を切り出すときに使われるCapped bond、 :guilabel:`++ 105` から :guilabel:`- 108` はMOPACのスパークル、 :guilabel:`Tv 109` はMOPACの並進ベクトル、 :guilabel:`Xx 110` から :guilabel:`Z 112` は各ソルバのダミー原子をそれぞれ意味します。
      
.. _edit_atom_opt:
      
最適化フラグ変更
^^^^^^^^^^^^^^^^^^^^
   選択した原子の最適化フラグを変更します。グループ選択されている場合はグループ選択された原子が対象となります。 :guilabel:`Solver` で :guilabel:`General` が選択されている場合は、X,Y,Zそれぞれに選択したフラグがそのまま設定されます。 :guilabel:`Solver` で具体的なソルバーが選択されている場合は、それぞれ該当するフラグが設定されます。
   
   .. warning::
      ただし、OpenMXの場合は、 :ref:`座標表示エリア <gui_main>` 上で ``0`` と表示されていたら入力ファイルに ``1``, 逆に ``1`` と表示されていたら ``0`` と出力されます。

電荷/スピン変更
^^^^^^^^^^^^^^^^^^^^
   選択した原子の電荷（User Charge）またはスピン密度（Spin Density）の値を変更します。グループ選択されている場合はグループ選択された原子が対象となります。
   
   .. note::
      User ChargeまたはSpin Densityを表示したい場合は、  :ref:`表示ボタンエリア <gui_main>` の :guilabel:`アノテーション` ボタン |annotation| から :guilabel:`User Charge` または :guilabel:`Spin Density` を選択します。

.. _edit_bond:

結合
-------------------------------------

結合付加
^^^^^^^^^^^^^^^^^^^^
   マーカー（赤太丸、赤細丸）が付いた2原子間に結合を生成します。すでに生成している場合は、結合の種類が変更されます。結合の種類としては、一重、二重、三重、芳香環（1.5重）、赤色（特に物理的な意味は持たせていません）の5つが定義されています。
   
   .. hint::
      :kbd:`F7` または :ref:`編集ボタンエリア <gui_main>` の :guilabel:`結合付加` ボタンでも操作できます。
   
結合削除
^^^^^^^^^^^^^^^^^^^^
   マーカー（赤太丸、赤細丸）が付いた2原子間の結合を削除します。
   
   .. hint::
       :kbd:`F8` または :ref:`編集ボタンエリア <gui_main>` の :guilabel:`結合削除` ボタンでも操作できます。

結合再生成
^^^^^^^^^^^^^^^^^^^^
   原子間距離から結合の有無と種類を判定して、結合を割り当てなおします。

芳香環を単結合+2重結合に変換
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   芳香環結合を単結合と二重結合の組み合わせに変更します。

.. _edit_hydrogen:

水素付加
-------------------------------------
   欠落している水素原子を補います。
   
座標調整
^^^^^^^^^^^^^^^^^^^^
   ChemDrawのmol形式の読み込み時など、水素原子の結合距離が異常な際、水素付加前に結合距離を調整することが出来ます。
   
全原子 
^^^^^^^^^^^^^^
   全原子に水素を自動的に付加します。
   
   .. hint::
      :kbd:`Ctrl+H` でも操作できます。
      
１原子
^^^^^^^^^^^^^^^^^^^^
   マーカーが付いた原子に水素原子を1つ付加します。
   
   .. hint::
       または :ref:`編集ボタンエリア <gui_main>` の :guilabel:`+H` ボタンでも操作できます。

１原子(H1)、(H2)、(H3)
^^^^^^^^^^^^^^^^^^^^^^^^^^
   マーカーが付いた原子に水素が1～3つ結合した状態にします。

pdb2gmxを使用
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   Gromacsの :command:`gmx pdb2gmx` コマンドを用いて、pdbまたはgroファイルから読み込んだタンパク質に対して水素を自動的に付加します。
   元となるpdbまたはgroファイルにおいて、アミノ残基の情報を持たない原子が存在している場合には、処理に失敗します。
   :file:`*_protonate_tmp` という作業フォルダに中間ファイルが生成されます。
   
   .. note::
      リガンド、溶媒などのタンパク質以外の分子は、:menuselection:`編集 -->` :ref:`edit_select_mole` および :menuselection:`部分編集 -->` :ref:`edit_partial_delete` 機能を用いて事前に削除してください。
   
   .. include:: ../cygwinwm_required.rst

OpenBabelを使用
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   OpenBabelを用いて水素を自動的に付加します。
   主にpdbファイルから切り出したリガンド分子に対して使用します。
   :file:`*_protonate_tmp` という作業フォルダに中間ファイルが生成されます。

   .. note::
      リガンド以外の分子は、:menuselection:`編集 -->` :ref:`edit_select_mole` および :menuselection:`部分編集 -->` :ref:`edit_partial_delete` 機能を用いて事前に削除してください。

   .. include:: ../cygwinwm_required.rst

水素削除
-------------------------------------
   全ての水素原子を削除します。

.. _edit_partial_edit:

部分編集
-------------------------------------
   :ref:`グループ選択（青丸） <edit_top>` された原子に対して操作を行います。

.. _edit_partial_rotate:

部分回転
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   :ref:`2つのマーカー（赤太丸、赤細丸） <edit_top>` が付いた2原子間のベクトルを軸として部分構造を回転させます。
   
   .. hint::
       :kbd:`Ctrl+R` でも操作できます。
   
結合角変更
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   結合角をカメラに表示された面内で変更します。まず変更したい結合角の位置にある原子にマーカーを付け、次に、結合角を変更した際に回転させたい部分構造に含まれる原子にマーカーを付けた状態で本機能を実行します。
   
   .. hint::
       :kbd:`Ctrl+A` でも操作できます。
   
部分移動
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を :ref:`分子表示エリア <gui_main>` 内でドラッグして移動させます。
   
   .. hint::
       :kbd:`Ctrl+M` でも操作できます。
   
部分移動(スライダー) 
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を、スライダー操作または数値入力により並進移動させます。
   
部分自由回転
^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を、 :ref:`マーカー（赤太丸） <edit_top>` が付いた原子を中心に自由回転させます。
   
   .. hint::
       :kbd:`Ctrl+F` でも操作できます。
   
部分クリーン
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造に対し、簡易的な分子力場計算を実行し、瞬時に構造最適化を行います。
   
   .. hint::
       :kbd:`Ctrl+L` でも操作できます。
   
部分重心
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造の重心の位置にダミー原子を生成します。

部分配向
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を特定軸または特定面に対し配向させます。
   部分構造は複数選択されていて、2あるいは3つの選択原子は部分構造に含まれている必要があります。

部分切り取り
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を、クリップボードに切り取ります。
   
   .. hint::
       :kbd:`Ctrl+X` でも操作できます。
   
部分コピー
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を、クリップボードにコピーします。
   
   .. hint::
       :kbd:`Ctrl+C` でも操作できます。
   
部分貼り付け
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を、クリップボードから貼り付けます。貼り付け後、ドラッグして位置を決定します。
   
   .. hint::
       :kbd:`Ctrl+V` でも操作できます。
   
部分複製
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造を、一定間隔で複製して配置します。サブウインドウにて各方向の配置間隔と複製数を指定します。
   
.. _edit_partial_delete:
   
部分削除
^^^^^^^^^^^^^
   選択された部分構造、あるいはそれ以外の構造を削除します。分子内の一部の構造を削除した場合は、切断された箇所に水素原子を自動で補います。
   
   .. hint::
       :kbd:`Ctrl+D` でも操作できます。
   
部分固定・自由
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   選択された部分構造の全成分の最適化フラグを ``0`` （fix）または ``1`` （free）に設定します。より細かい制御をしたい場合は :menuselection:`編集 --> 原子 -->` :ref:`edit_atom_opt` を選択してください。
   
   .. hint::
       :kbd:`Ctrl+I` でも操作できます。
      
変更
-------------------------------------
   マーカー（赤丸）が付けられた2～4原子間の、距離、角度または二面角を入力して変更します。3, 4番目のマーカーは :ref:`分子表示エリア <gui_main>` に赤丸で表示されませんが、内部的に記憶されており、 :ref:`分子表示エリア <gui_main>` 左上に表示されます。

.. _edit_aromatic:

環構築
-------------------------------------
   連結した4原子の両端2原子にマーカー（太赤丸、細赤丸）が付いた状態で同機能を選択すると、その4原子を骨格に含む芳香環を生成します。
   
   .. hint::
       :kbd:`F9` でも操作できます。
       
   .. hint::
      例えばベンゼン分子のH-C-C-Hという部分の両端のHにマーカーを移動し、本機能を呼び出すと、ナフタレン分子が作成されます。
   

.. _edit_parts:

部品
-------------------------------------

部品置換
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   マーカー（太赤丸）が付いた原子を、:ref:`編集ボタンエリア <gui_main>` の :guilabel:`部品選択` プルダウンメニュー |repl| で選ばれた部品（置換基）で置換します。:guilabel:`部品選択` プルダウンメニューの中で、 :guilabel:`-CHCH-` と :guilabel:`-CH-` は多環構造を作るための部品で、置換部品が2番目のマーカー（赤細丸）が付いた原子の方向に向くように生成されます。
   
   .. hint::
       :kbd:`F6` 、 :guilabel:`Repl` ボタン、または原子を右クリックでも操作できます。
   
部品登録
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   メインウインドウに表示されている分子構造を部品として登録します。マーカー（太赤丸）の付いた原子が置換時に接続部分に来ます。

部品削除
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   :ref:`編集ボタンエリア <gui_main>` の :guilabel:`部品選択` プルダウンメニューで選ばれた部品の登録を削除します。

番号交換
-------------------------------------
   マーカーが付いた2つの原子の番号を交換します。主にZ-Matrixの編集時に使われます。

原子の並び替え
-------------------------------------
   水素以外の原子、水素原子という順番となるように原子の番号を並べ替えます。

配向
-------------------------------------

設定
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   現在の配向を初期配向に設定します。具体的には、現在のカメラの視線の逆方向をZ軸、カメラの上方向をY軸、カメラの右方向をX軸として再定義し、分子を回転させます。

設定（３点）
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   事前にクリックして指定した３点で決まる平面を、初期配向に設定します。具体的には、指定した３点で決まる平面の法線方向をZ軸、１番目と２番目に選ばれた原子の方向をX軸として取り直します。

原点設定
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   マーカーの付いた原子を原点に設定します。

.. _edit_zm:

Z-Matrix
-------------------------------------

.. _edit_zm_addatom:

原子追加
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    :ref:`編集ボタンエリア <gui_main>` の :guilabel:`元素選択` プルダウンメニューで選択された原子を追加します。まず原子を置く場所をクリックし、次にZ-Matrix表記における3つの接続原子（Na, Nb, Nc）を順番にクリックします。

ダミー原子追加
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   ダミー原子を追加します。

二面角変更
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   マーカーの付いた原子のZ-Matrix表記における2面角を :ref:`分子表示エリア <gui_main>` でドラッグして変更します。

結合関係変更
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   マーカーの付いた原子のZ-Matrix表記における3つの接続原子（Na, Nb, Nc）を順番にクリックして再指定します。

原子移動
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   １原子を移動することで、Z-Matrixの結合関係にある原子も移動します。

Z-Matrix再生成
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   Z-Matrixを自動的に再生成します。接続原子も自動で変更されます。

..  _edit_clean:

クリーン
-------------------------------------
   簡易的な分子力場計算を実行し、瞬時に構造最適化を行います。
   
   .. hint::
   
       :kbd:`Ctrl+G` でも操作できます。

座標反転
-------------------------------------
   メインウインドウに表示されている分子構造を鏡像体に変換します。x座標の符号が反転されます。

鏡像体生成
-------------------------------------
   メインウインドウに表示されている分子構造の鏡像体を、現在の構造に隣接して生成します。

.. _edit_select_mole:

分子種単位で選択
-------------------------------------
   :guilabel:`Select Molecules` ウインドウが開き、メインウインドウに表示されている分子構造中の各成分（分子種）の分子数がリスト表示されます。リストの中でチェックを入れた種類の分子をグループ選択します。
   
   .. note::
      例えば、タンパク質を含むpdbファイル、タンパク・リガンド・結合水・緩衝剤などを抜き出す際に有用な機能です。

分子種でソート
-------------------------------------
   同じ種類の分子が連続するよう原子の順番を並べ替えます。

.. _edit_createcell:

セルを作成/編集
-------------------------------------
   :guilabel:`Create/Edit Cell` ウインドウが開き、そこでMD計算や平面波DFT計算などのシミュレーションセルを作成または編集します。
   セルが存在しない場合は、 :guilabel:`Create` ボタンをクリックすると、メインウインドウに表示されている分子構造の各方向の最小・最大値から :guilabel:`Distance` の距離だけ離れた場所にセルを作成します。
   :guilabel:`Expand` ボタンクリックすると、指定方向にセルサイズを拡張することができます。
   :guilabel:`Create/Edit Cell` ウインドウの右側では直接セルサイズの値を編集することができます。
   :guilabel:`Box Vecors` , :guilabel:`Lattice Constants` , :guilabel:`LAMMPS Tilt Factors` をクリックし、セルサイズの表記方法を変えることができます。
   
   .. note::
      - :menuselection:`環境設定 --> 表示 --> 表示選択 --> 格子定数` にチェックを入れると :ref:`分子表示エリア <gui_main>` に格子定数を表示することも可能です。
      - 本機能でセルサイズを変更しても、原子の座標は変化しないため、セルサイズに合わせて原子の座標も相似的に変化させたい場合は :ref:`edit_change_density` を使用します。
      - シミュレーションセルの外にある原子を編集前のシミュレーションセルの中に戻したい場合は :ref:`edit_wrap_pbc` 機能を使用します。
      
.. _edit_wrap_pbc:

周期境界折り返し
-------------------------------------
   シミュレーションセルの外に出ている原子の座標を、周期境界を考慮してセル内に戻します。
   「結合を保持しますか?」と聞かれたら、共有結合の情報を保持したい場合（主に分子系）は :guilabel:`はい` 、そうでない場合（主に無機系）は :guilabel:`いいえ` をクリックします。
   
   .. note::
   
      - :menuselection:`表示 --> 周期境界折り返し表示 --> なし` が選択されていると、座標の変化を確認しやすくなります。
      - :menuselection:`表示 --> 周期境界折り返し表示` 機能では、表示のみが変化し座標は変化しませんが、本機能では実際に座標が変化します。
      
.. _edit_change_density:

密度を変更
-------------------------------------
   密度を変更を指定して、シミュレーションセルと原子座標を相似的に拡大または縮小します。
   各原子の座標は、分子の重心について拡大縮小され、分子内での相対位置は変化しません。

慣性主軸方向に回転
-------------------------------------
   慣性主軸がX,Y,Z軸と一致するように系全体を回転させます。長軸がX軸となります。
   
   .. include:: ../cygwinwm_required.rst
   
